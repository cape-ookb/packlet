# Chunk Format Documentation

> **⚠️ DEPRECATED**: This document has been superseded by [`chunk-output-format.md`](./chunk-output-format.md) which contains the complete, up-to-date specification with all field definitions, examples, and migration notes. This legacy document is kept for reference but should not be used for new implementations.

This document describes the structure and purpose of each field in the chunk objects generated by the `generate_chunks.py` script.

## Chunk Structure Overview

Each chunk represents a semantically meaningful segment of content (typically from markdown documents) optimized for vector embedding and retrieval.

## Field Descriptions

### Core Identifiers

- **`id`** (string): Unique identifier for the chunk in format `{contentType}:{slug}::ch{number}`
  - Example: `"doc:skeleton::ch4"`
  - Used for direct chunk retrieval and as embedding keys

- **`parentId`** (string): Identifier of the source document in format `{contentType}:{slug}`
  - Example: `"doc:skeleton"`
  - Links chunks back to their originating document

- **`prevId`** (string|null): ID of the previous chunk in sequence
  - Example: `"doc:skeleton::ch3"`
  - Enables sequential navigation through document chunks
  - `null` for the first chunk in a document

- **`nextId`** (string|null): ID of the next chunk in sequence
  - Example: `"doc:skeleton::ch5"`
  - Enables sequential navigation through document chunks
  - `null` for the last chunk in a document

### Content Fields

- **`embedText`** (string): Processed text optimized for vector embeddings
  - Includes contextual prefix with document title and section hierarchy
  - Cleaned of markdown formatting but preserves semantic meaning
  - Example: `"Title: skeleton.txt\n\n### Base\n\nControls the style of the..."`

- **`displayMarkdown`** (string): Original markdown content for human display
  - Preserves formatting, links, and markdown syntax
  - Used for presenting chunks to users in search results

### Structural Information

- **`chunkNumber`** (integer): Zero-based sequential position within the parent document
  - Example: `4` (indicates this is the 5th chunk in the document)
  - Used for ordering and reference

- **`contentType`** (string): Type of source content
  - Example: `"doc"` for documentation, `"post"` for blog posts
  - Enables content-type-specific processing and filtering

- **`heading`** (string): Most relevant heading found in the chunk
  - Example: `"### Base"`
  - Extracted from the first markdown heading encountered in the chunk
  - Empty string if no heading is found

- **`headerPath`** (array): Hierarchical path of all parent headings
  - Example: `["# Typography", "## Semantic Typography", "### Base"]`
  - Provides full document context for the chunk's position
  - Used for contextual understanding and navigation

### Position Tracking

- **`charOffsets`** (object): Character position information within source document
  > **Note**: In the current implementation (see `chunk-output-format.md`), this is renamed to `sourcePosition` for clarity
  - **`charStart`** (integer): Starting character position in source
  - **`charEnd`** (integer): Ending character position in source
  - **`sourceLength`** (integer): Total length of source document (renamed to `totalChars` in current implementation)
  - Used for highlighting and precise content location
  - Derived from AST position data: `start.offset`, `end.offset`, and original source length

### Metadata

- **`metadata`** (object): Document-level information inherited from source
  - **`source`** (string): Source identifier (e.g., `"skeleton"`)
  - **`fileName`** (string): Original filename (e.g., `"skeleton.txt"`)
  - **`timestamp`** (string): Processing timestamp in ISO format
  - Additional fields vary by content type (title, date, tags, etc.)
- tokenCount: number
- nodeTypes: array of type ids this chunk contains ('paragraph, 'list', 'code', 'table')
- source: { filePath: string, startLine: number, endLine: number }

## Chunking Strategy

### Token Limits
> **Note**: For current token limit defaults, see `lib/default-config.ts`
- **Target tokens**: ~400-500 average (configurable)
- **Token range**: 64-512 strict range (configurable)
- **Overlap**: Configurable via `overlapSentences` parameter (default: 2 sentences)

### Context Enhancement
- Each chunk includes document title as prefix
- Header hierarchy provides section context
- Previous/next linking enables document traversal
- Character offsets allow precise source highlighting
